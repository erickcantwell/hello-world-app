{
  "variables": {
    "git_commit": "",
    "git_branch": "",
    "account_file": "",
    "project_id": "null"
  },
  "builders": [
    {
      "type": "docker",
      "image": "centos:latest",
      "commit": "true"
    }
  ],
  "provisioners": [
    { "type": "shell",
      "inline": ["yum install -y epel-release sudo && yum install -y puppet && sed -i.bak -e '/Defaults.*requiretty/s/^/#/' /etc/sudoers"]
    },
    {
      "type": "puppet-masterless",
      "manifest_file": "puppet/site.pp"
    }
  ],
  "post-processors": [
        [
            {
                "type": "docker-tag",
                "repository": "172.16.0.54:5000/{{user `project_id`}}/hello-world",
                "tag": "{{user `git_branch`}}-{{user `git_commit`}}",
                "only": ["docker"]
            }
        ]
    ]
}
